# CC: Pen Testing

This is a writeup for the [CC: Pen Testing](https://tryhackme.com/room/ccpentesting) room on TryHackMe.

### Task 1: Introduction

The idea behind this room is to provide an introduction to various tools and concepts commonly encountered in penetration testing. 

This room assumes that you have basic linux and networking knowledge. This room is also not meant to be a "be all end all" for penetration testing

The tasks in this room can be completed in any order; however, if you are new to penetration testing, completing the first two sections is recommended before doing anything else.

1. Read the above.

   > No answer needed

### Task 2: [Section1 - Network Utilities] - nmap

nmap is one of the most important tools in a pen testers arsenal. It allows a pen tester to see which ports are open, and information about which services are running on those ports. Ergo this task will focus on showing you nmap's various flags. The beginning questions can be completed by using the nmap man page; The final questions will require you to deploy the machine.

1. What does nmap stand for?

   > Network Mapper

2. How do you specify which port(s) to scan?

   > -p

3. How do you do a "ping scan"(just tests if the host(s) is up)?

   > -sn

4. What is the flag for a UDP scan?

   > -sU

5. How do you run default scripts?

   > -sC

6. How do you enable "aggressive mode"(Enables OS detection, version detection, script scanning, and traceroute)?

   > -A

7. What flag enables OS detection?

   > -O

8. How do you get the versions of services running on the target machine ?

   > -sV

9. Deploy the machine.

   Machine IP: 10.10.186.113

   > No answer needed

Command: `map -sV -sC 10.10.186.113` [Scan results](https://github.com/pamhrituc/TryHackMe_Writeups/blob/master/room_cc_pen_testing/service_scan.log)

10. How many ports are open on the machine?

   > 1

11. What service is running on the machine?

   > Apache

12. What is the version of the service?

   > 2.4.18

13. What is the output of the http-title script(included in default scripts)?

   > Apache2 Ubuntu Default Page: It works

### Task 3: [Section 1 - Network Utilities] - Netcat

Netcat aka nc is an extremely versatile tool. It allows users to connect to specific ports and send and receive data. It also allows machines to receive data and connections on specific ports, which makes nc a very popular tool to gain a [Reverse Shell](https://resources.infosecinstitute.com/icmp-reverse-shell/#gref).

After you connect to a port with nc you will be able to send data, this also has the consequence of the user being able to pipe data through nc. For example one can do `echo hello | nc <ip> 1234` to send the string hello to the service running on port 1234

Note: There are multiple versions of nc, so if you are unable to find an answer in your specific man page, try reading the man page for others!

1. How do you listen for connections?

   > -l

2. How do you enable verbose mode(allows you to see who connected to you)?

   > -vv

3. How do you specify a port to listen on?

   > -p

4. How do you specify which program to execute after you connect to a host(One of the most infamous)?

   > -e

5. How do you connect to udp ports?

   > -u

### Task 4: [Section 2 - Web Enumeration] - gobuster

One of the main problems of web penetration testing is not knowing where anything is. Basic reconnaissance can tell you where some files and directories are; however, some of the more hidden stuff is often hidden away from the eyes of users. This is where gobuster comes in, the idea behind gobuster is that it tries to find valid directories from a wordlist of possible directories. gobuster can also be used to valid subdomains using the same method.

The beginning questions of this task use the gobuster man page, while the latter questions will use a virtual machine.

Man page: `gobuster -h`, `gobuster dir --help`

1. How do you specify directory/file brute forcing mode?

   > dir

2. How do you specify dns bruteforcing mode?

   > dns

3. What flag sets extensions to be used?

   Example: if the php extension is set, and the word is "admin" then gobuster will test admin.php against the webserver

   > -x

4. What flag sets a wordlist to be used?

   > -w

5. How do you set the Username for basic authentication(If the directory requires a username/password)?

   > -U

6. How do you set the password for basic authentication?

   > -P

7. How do you set which status codes gobuster will interpret as valid?

   Example: 200,400,404,204

   > -s

8. How do you skip ssl cerificate verification?

   > -k

9. How do you specify a User-Agent?

   > -a

10. How do you specify a HTTP header?

    > -H

11. What flag sets the URL to bruteforce?

    > -u

12. Deploy the machine.

    Machine IP: 10.10.232.97

    > No answer needed

13. What is the name of the hidden directory?

    Command: `gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -u http://10.10.232.97`

   ![screenshot_dir](/room_cc_pen_testing/screenshots/dir.png?raw=true)

    > secret

14. What is the name of the hidden file with the extension xxa?

    Command: `gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x xxa -u http://10.10.232.97`

   ![screenshot_xxa](/room_cc_pen_testing/screenshots/xxa.png?raw=true)

    >  password

### Task 5: [Section 2 - Web Enumeration] nikto

nikto is a popular web scanning tool that allows users to find common web vulnerabilities. It is commonly used to check for common CVE's such as shellshock, and to get general information about the web server that you're enumerating.

1. How do you specify which host to use?

   > -h

2. What flag disables ssl?

   > -nossl

3. How do you force ssl?

   > -ssl

4. How do you specify authentication(username + pass)?

   > -id

5. How do you select which plugin to use?

   > -plugins

6. Which plugin checks if you can enumerate apache users?

   > apacheusers

7. How do you update the plugin list?

   > -update

8. How do you list all possible plugins to use?

   > -list-plugins

### Task 6: [Section 3 - Metasploit]: Intro

Metasploit is one of the most popular penetration testing frameworks around. It contains a large database of almost every major CVE, which you can easily use against a machine. The aim of this section is to go through some of the major features of metasploit, and at the end there will be a machine that you will need to exploit.

### Task 7: [Section 3 - Metasploit]: Setting Up

Once you have installed metasploit through either the [installer](https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers) or your distributions repos, you will have many new commands available to you. This section will primarily focus on the msfconsole command.

Running that command will present you with an "msf5" prompt which will allow you to enter commands. All tasks can be answered with use of the "help" command.

1. What command allows you to search modules?

   > search

2. How do you select a module?

   > use

3. How do you display information about a specific module?

   > info 

4. How do you list options that you can set?

   > options

5. What command lets you view advanced options for a specific module?

   > advanced

6. How do you show options in a specific category?

   > show

### Task 8: [Section 3 - Metasploit]: Selecting a module

Once you have found the module for the specific machine that you want to exploit, you need to select it and set the proper options. This task will take you through selecting and setting options for one of the most popular metasploit modules "eternalblue". All basic commands that could be run before selecting a module can also be done while a module is selected.

1. How do you select the eternalblue module?

   > set exploit/windows/smb/ms17_010_eternalblue

2. What option allows you to select the target host(s)?

   > RHOSTS

3. How do you set the target port?

   > RPORT

4. What command allows you to set options?

   > set

5. How would you set SMBPass to "username"?

   > set SMBPass username

6. How would you set the SMBUser to "password"?

   > set SMBUser password

7. What option sets the architecture to be exploited?

   > ARCH

8. What option sets the payload to be sent to the target machine?

   > payload

9. Once you've finished setting all the required options, how do you run the exploit?

   > exploit

10. What flag do you set if you want the exploit to run in the background?

    > -j

11. How do you list all current sessions?

    > sessions

12. What flag allows you to go into interactive mode with a session("drops you either into a meterpreter or regular shell")?

    > -i

### Task 9: [Section 3 - Metasploit]: meterpreter

Once you've run the exploit, ideally it will give you one of two things, a regular command shell or a meterpreter shell. Meterpreter is metasploits own "control center" where you can do various things to interact with the machine. A list of commonmeterpreter commands and their uses can be found [here](https://www.offensive-security.com/metasploit-unleashed/meterpreter-basics/).

Note: Regular shells can usually be upgraded to meterpreter shells by using the module `post/multi/manage/shell_to_meterpreter`

1. What command allows you to download files from the machine?

   > download

2. What command allows you to upload files to the machine?

   > upload

3. How do you list all running processes?

   > ps

4. How do you change processes on the victim host (Ideally it will allow you to change users and gain the perms associated with that user)?

   > migrate

5. What command lists files in the current directory on the remote machine?

   > ls

6. How do you execute a command on the remote host?

   > execute

7. What command starts an interactive shell on the remote host?

   > shell

8. How do you find files on the target host (Similar function to the linux command "find")?

   > search

9. How do you get the output of a file on the remote host?

   > cat

10. How do you put a meterpreter shell into "background mode" (allows you to run other msf modules while also keeping the meterpreter shell as a session)?

    > background

### Task 10: [Section 3 - Metasploit]: Final Walkthrough

It's time to put all the other metasploit tasks together and test them on an example machine. This machine is currently vulnerable to the metasploit module `exploit/multi/http/nostromo_code_exec` on port 80, and this task will take you through the process of exploiting it and gaining a shell on the machine.

Machine IP: 10.10.146.123

1. Select the module that needs to be exploited.

   > `use exploit/multi/http/nostromo_code_exec`

2. What variable do you need to set, to select the remote host?

   > RHOSTS

3. How do you set the port to 80?

   > `set RPORT 80`

4. How do you set listening address (Your machine)?

   > LHOST

5. Exploit the machine!

   > No answer needed

*Note: It looks like it hangs, but it doesn't.*

6. What is the name of the secret directory in the /var/nostromo/htdocs directory?

   ![screenshot_secret_dir](/room_cc_pen_testing/screenshots/secret_dir.png?raw=true)

   > s3cretd1r

7. What are the contents of the file inside of the directory?

   ![screenhot_nice](/room_cc_pen_testing/screenshots/nice.png?raw=true)

   > Woohoo!

### Task 11: [Section 4 - Hash Cracking]: Intro

Often times during a pen test, you will gain access to a database. When you investigate the database you will often find a users table, which contains usernames and often [hashed passwords](https://www.wired.com/2016/06/hacker-lexicon-password-hashing/). It is often necessary to know how to crack hashed passwords to gain authentication to a website(or if you're lucky a hashed password may work for ssh!).

### Task 12: [Section 4 - Hash Cracking]: Salting and Formatting

No matter what tool you use, virtually all of them have the exact same format. A file with the hash(s) in it with each hash being separated by a newline.

Example:

<hash1>

<hash2>

<hash3>


[Salt](https://en.wikipedia.org/wiki/Salt_(cryptography))s are typically appended onto the hash with a colon and the salt. Files with salted hashes still follow the same convention with each hash being separated by a newline.

Example:

<hash1>:<salt>

<hash2>:<salt>

<hash3>:<salt>


Note: Different hashing algorithms treat salts differently. Some prepend them and some append them. Research what it is you're trying to crack, and make the distinction.

### Task 13: [Section 4 - Hash Cracking]: hashcat

hashcat is another one of the most popular hash cracking tools. It is renowned for its versatility and speed. Hashcat does not have auto detection for hashtypes, instead it has modes. For example if you were trying to crack an md5 hash the "mode" would be 0, while if you were trying to crack a sha1 hash, the mode would be 100.


A full list of all modes can be found [here](https://hashcat.net/wiki/doku.php?id=example_hashes).

1. What flag sets the mode?

   > -m

2. What flag sets the "attack mode"?

   > -a

3. What is the attack mode number for Brute-force?

   > 3

4. What is the mode number for SHA3-512?

   > 17600

5. Crack This Hash: 56ab24c15b72a457069c5ea42fcfc640

   Type: MD5

   Command: `hashcat -m 0 "56ab24c15b72a457069c5ea42fcfc640" /usr/share/wordlists/rockyou.txt`

   > happy

6. Crack this hash: 4bc9ae2b9236c2ad02d81491dcb51d5f

   Type: MD4

   Command: `hashcat -m 900 "4bc9ae2b9236c2ad02d81491dcb51d5f" /usr/share/wordlists/rockyou.txt`

   > nootnoot

### Task 14: [Section 4 - Hash Cracking]: John The Ripper

John The Ripper(jtr) is one of the best hash cracking tools available. It supports numerous formats of hashes and is extremely easy to use, while having a lot of options for customization.

Note: There are multiple variations of jtr out there. For this task the version that comes pre-installed on kali will be used

Note 2: All hashes can be cracked with rockyou.txt


1. What flag let's you specify which wordlist to use?

   > -wordlist

2. What flag lets you specify which hash format(Ex: MD5,SHA1 etc.) to use?

   > --format

3. How do you specify which rule to use?

   > --rules

4. Crack this hash: 5d41402abc4b2a76b9719d911017c592

   Type: MD5

   Command: `john --format=Raw-MD5 -wordlist:/usr/share/wordlists/rockyou.txt john_1.txt` and then `john --show --format=Raw-MD5 john_1.txt` to show the cracked password.

   > hello

5. Crack this hash: 5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8

   Type: SHA1

   Command: `john --format=Raw-SHA1 -wordlist:/usr/share/wordlists/rockyou.txt john2.txt` and then `john --show --format=Raw-SHA1 john2.txt` to show the cracked password.

   > password

### Task 15: [Section 5 - SQL Injection]: Intro
### Task 16: [Section 5 - SQL Injection]: sqlmap
### Task 17: [Section 5 - SQL Injection]: A Note on Manual SQL Injection
### Task 18: [Section 5 - SQL Injection]: Vulnerable Web Application
### Task 19: [Section 6 - Samba]: Intro
### Task 20: [Section 6 - Samba]: smbmap
### Task 21: [Section 6 - Samba]: smbclient
### Task 22: [Section 6 - Samba]: A note about impacket
### Task 23: [Miscellaneous]: A note about privilege escalation
### Task 24: [Section 7: Final Exam]: Good Lick :D
